---
name: exec-task
tools: Read, Grep, Glob, Write, Bash(git:*), Bash(mkdir:*),Bash(touch:*),  mcp__serena__get_symbols_overview, mcp__serena__find_file, mcp__serena__find_symbol, mcp__serena__list_memories, mcp__serena__search_for_pattern, mcp__serena__list_dir
description: 計画に基づいてタスクを開始し、進捗を追跡します
argument-hint: "optional 対象タスクの指示"
---

# タスク開始コマンド

このコマンドは、仕様駆動開発プロセスにおけるタスクの開始と進捗を記録します。

## コンテキスト

- 対象タスク: $ARGUMENTS
- 要件定義書: @.tmp/requirements.md
- 設計書: @.tmp/design.md
- テスト設計書: @.tmp/test-design.md
- タスクリスト: @.tmp/tasks.md
- Git status: git statusの取得を試行（失敗しても継続）

### フェーズ1: ドキュメントの検出

1. tasks.md、requirements.md、design.mdの存在を確認
2. 重要なファイルが不足している場合、適切なコマンドを先に実行するようユーザーに促す：
   - requirements.mdがない → `/spec:requirements_jp [機能の説明]`を提案
   - design.mdがない → `/spec:design_jp`を提案
   - tasks.mdがない → `/spec:tasks_jp`を提案
   - test-design.mdがない → `/spec:test-design_jp`を提案
3. 利用可能な仕様書をすべて読み取り分析


### フェーズ3: Gitステータスとタスクの状況確認

1. `git status`で変更されたファイルをリスト
2. `git diff --stat`で変更の統計情報を確認
3. `git diff`で具体的なこれまでの変更内容を分析
4. **対象タスクの特定ルール**：
     - ARGUMENTSが指定されている場合：該当タスクを検索
     - 指定なしの場合：Phase順で最初の未完了タスク（`- [ ]`）を特定
     - 対応するチェックボックス群で未完了項目があるタスクを対象


### フェーズ4: 焦点タスクの確認と実行

**重要: 既存のファイルやコードを調査する際は、必ずserenaを使用してください。serenaを使用することで、トークン消費量が60-80%削減され、セマンティック検索機能を通じて必要な情報を効率的に取得できます。**

1. **対象タスクのみ**: タスクリストから見つかった最初の未完了タスクのみを扱い、他のタスクを許可なしに実行しない
2. **依存関係の特定**: タスクが他のタスクに依存している場合、その依存関係のタスクが生成した設計とコードを調査
3. **完了条件の特定**: タスクが完了と見なされるための具体的な条件の記載を確認
4. **実行計画の策定**: タスクを実行するための具体的な手順と計画を策定
5. **実行**: 実行計画に従ってタスクを実行
6. **結果の確認**: タスクの実行結果を確認し、完了条件を満たしているか確認

### フェーズ5: タスク完了記録

**重要**: タスク完了後完了を記録する

1. **TodoWrite完了監視**: 現在のタスクに関連するすべてのTodoがcompletedになったことを確認
2. **tasks.md自動更新**:
   - 対象タスクの全チェックボックス `- [ ]` を `- [x]` に更新
   - Editツールを使用してファイルを直接編集
   - Readツールで更新を検証
3. **更新確認**: ユーザーに「Task X.X完了をtasks.mdに記録しました」と通知

### フェーズ6: Git Commit

1. `git status`で変更されたファイルを確認
2. `git add .`で焦点タスクに関連するすべての変更をステージ
3. `.tmp/commit-message.txt`に以下の形式でコミットメッセージを生成：
   ```
   fix(start_task): [タスク名] - [タスクの説明]
   
   詳細:
   - [完了した具体的な作業項目1]
   - [完了した具体的な作業項目2]
   - [完了した具体的な作業項目3]
   
   関連タスク: #[タスク番号]
   ```
4. `git commit -F .tmp/commit-message.txt`でコミット

### ェーズ7: 完了検証

1. **更新前後の差分確認**: `git diff .tmp/tasks.md`で変更内容を表示
2. **整合性チェック**: TodoWriteの完了タスクとtasks.mdの更新が一致することを確認
3. **次タスクの提示**: 次の未完了タスクがあれば表示

## 重要な注意事項

- 計画全体を通して単一タスクの実行が維持されている
- 現在のタスクが要件と設計制約に整合している
- Todoリストが対象タスクの明確なサブステップで実行可能
- タスクの依存関係が特定され対処されている
- 実装アプローチが明確で実現可能
- 計画が実装開始に十分な詳細を提供している
- すべてのTodoが完了した時にタスク完了が`.tmp/tasks.md`で自動追跡される
- タスクステータス更新で`.tmp/tasks.md`のすべてのメタデータと書式が保持される

think hard
