---
allowed-tools: TodoWrite, TodoRead, Read, Write, MultiEdit, mcp__serena__find_file, mcp__serena__find_symbol, mcp__serena__list_memories, mcp__serena__search_for_pattern
description: 設計を実装可能なタスクに分解します（仕様駆動開発のステージ4）
---

## コンテキスト

- 要件書: @.tmp/requirements.md
- 設計書: @.tmp/design.md

## あなたのタスク

### 1. 前提条件の確認

- `.tmp/requirements.md`と`.tmp/design.md`の両方が存在することを確認
- 存在しない場合は、前のステージを最初に完了するようユーザーに通知

### 2. 設計書の分析

**重要: 既存のファイルやコードを調査する際は、必ずserenaを使用してください。serenaを使用することで、トークン消費量が60-80%削減され、セマンティック検索機能を通じて必要な情報を効率的に取得できます。**

すべての実装タスクを特定するために設計を徹底的に読み理解してください

### 3. タスクリスト文書の作成

以下の構造で`.tmp/tasks.md`を作成してください：

```markdown
# タスクリスト - [機能/改善名]

## 概要

- 総タスク数: [数]
- 推定作業時間: [時間/日数]
- 優先度: [高/中/低]

## タスク一覧

### Phase 1: 準備・調査

#### Task 1.1: [タスク名]

- [ ] [具体的な作業項目1]
- [ ] [具体的な作業項目2]
- [ ] [具体的な作業項目3]
- **完了条件**: [明確な完了条件]
- **依存**: [依存するタスク または なし]
- **推定時間**: [時間]

#### Task 1.2: [タスク名]

- [ ] [具体的な作業項目1]
- [ ] [具体的な作業項目2]
- **完了条件**: [明確な完了条件]
- **依存**: [依存するタスク]
- **推定時間**: [時間]

### Phase 2: 実装

#### Task 2.1: [機能名]の実装

- [ ] [実装項目1]
- [ ] [実装項目2]
- [ ] [実装項目3]
- **完了条件**: [明確な完了条件]
- **依存**: [依存するタスク]
- **推定時間**: [時間]

#### Task 2.2: [機能名]の実装

- [ ] [実装項目1]
- [ ] [実装項目2]
- **完了条件**: [明確な完了条件]
- **依存**: [依存するタスク]
- **推定時間**: [時間]

### Phase 3: 検証・テスト

#### Task 3.1: [検証項目]

- [ ] [テスト項目1]
- [ ] [テスト項目2]
- [ ] [テスト項目3]
- **完了条件**: [明確な完了条件]
- **依存**: [依存するタスク]
- **推定時間**: [時間]

### Phase 4: 仕上げ

#### Task 4.1: [仕上げ項目]

- [ ] [仕上げ作業1]
- [ ] [仕上げ作業2]
- **完了条件**: [明確な完了条件]
- **依存**: [依存するタスク]
- **推定時間**: [時間]

## 実装順序

1. Phase 1から順次実行
2. 並行実行可能なタスクは並行で実行
3. 依存関係を考慮した実装順序

## リスクと対策

- [特定されたリスク]: [対策方法]

## 注意事項

- 各タスクはコミット単位で完結させる
- タスク完了時は必要に応じて品質チェックを実行
- 不明点は実装前に確認する
```

### 4. TodoWriteでタスクを登録

主要なタスク（フェーズレベルまたは重要なタスク）を抽出し、適切な優先度でTodoWriteツールを使用して登録

### 5. 実装ガイドの作成

tasks.mdの最後に以下のセクションを追加：

```markdown
## 実装開始ガイド

1. このタスクリストに従って順次実装を進めてください
2. 各タスクの開始時にTodoWriteでin_progressに更新
3. 完了時はcompletedに更新
4. 問題発生時は速やかに報告してください
```

### 6. ユーザーへの提示

タスク分解を表示し、以下を行ってください：

- 実装順序を説明
- クリティカルパスがあればハイライト
- 実装開始の承認を求める

## 重要な注意事項

- タスクはコミットサイズ（1-4時間で完了可能）である必要があります
- 各タスクに明確な完了基準を含めてください
- 並行実行の機会を考慮してください
- 最後にまとめるのではなく、全体を通してテストタスクを含めてください

think hard
